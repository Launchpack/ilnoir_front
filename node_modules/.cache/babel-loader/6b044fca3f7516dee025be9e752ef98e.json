{"remainingRequest":"/Users/mard/dev/grit12/node_modules/babel-loader/lib/index.js!/Users/mard/dev/grit12/node_modules/cache-loader/dist/cjs.js??ref--0-0!/Users/mard/dev/grit12/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/mard/dev/grit12/src/components/Components/Block/BlockReviewReg.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/mard/dev/grit12/src/components/Components/Block/BlockReviewReg.vue","mtime":1605260027000},{"path":"/Users/mard/dev/grit12/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/mard/dev/grit12/node_modules/babel-loader/lib/index.js","mtime":315532800000},{"path":"/Users/mard/dev/grit12/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/mard/dev/grit12/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["import \"core-js/modules/es6.string.sub\";\nimport \"core-js/modules/web.dom.iterable\";\nimport \"core-js/modules/es6.array.for-each\";\nimport \"core-js/modules/es6.regexp.replace\";\nimport \"core-js/modules/es6.array.filter\";\nimport \"core-js/modules/es6.number.constructor\";\nimport \"regenerator-runtime/runtime\";\nimport _asyncToGenerator from \"/Users/mard/dev/grit12/node_modules/@babel/runtime-corejs2/helpers/esm/asyncToGenerator\";\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport CardProductReview from \"@/components/Components/Card/CardProductReview\";\nimport BlockMixin from \"@/components/Mixins/BlockMixin\";\nimport FormMixin from \"@/components/Mixins/FormMixin\";\nimport HeaderMixin from \"@/components/Mixins/HeaderMixin\";\nimport FormCustomMixin from \"@/components/Components/Mixin/FormCustomMixin\";\nexport default {\n  name: 'BlockReviewReg',\n  components: {\n    CardProductReview: CardProductReview\n  },\n  mixins: [BlockMixin, FormMixin, HeaderMixin, FormCustomMixin],\n  props: {},\n  data: function data() {\n    return {\n      \"formData\": [{\n        \"name\": \"평점\",\n        \"field\": \"rate\",\n        \"label\": \"평점\",\n        \"value\": 5,\n        \"format\": \"CRating\",\n        \"validate\": {\n          \"required\": false,\n          \"valid_required\": false\n        }\n      }, {\n        \"name\": \"제목\",\n        \"field\": \"title\",\n        \"label\": \"제목\",\n        \"value\": \"\",\n        \"format\": \"CInput_text\",\n        \"validate\": {\n          \"num\": true,\n          \"alpha_g\": true,\n          \"alpha_s\": true,\n          \"special\": true,\n          \"required\": true,\n          \"max_length\": 30,\n          \"min_length\": 1,\n          \"valid_required\": true\n        },\n        \"placeholder\": \"제목을 입력하세요\"\n      }, {\n        \"name\": \"내용\",\n        \"field\": \"content\",\n        \"label\": \"내용\",\n        \"value\": \"\",\n        \"format\": \"CInput_textarea\",\n        \"validate\": {\n          \"num\": true,\n          \"alpha_g\": true,\n          \"alpha_s\": true,\n          \"special\": true,\n          \"required\": true,\n          \"max_length\": 500,\n          \"min_length\": 1,\n          \"valid_required\": true\n        },\n        \"placeholder\": \"내용을 입력하세요\"\n      }, {\n        \"name\": \"비밀글\",\n        \"field\": \"is_secret\",\n        \"label\": \"비밀글로 작성합니다.\",\n        \"value\": false,\n        \"format\": \"CInput_checkbox\",\n        \"validate\": {\n          \"num\": true,\n          \"alpha_g\": true,\n          \"alpha_s\": true,\n          \"special\": true,\n          \"required\": false,\n          \"valid_required\": false\n        },\n        \"placeholder\": \"\"\n      }, {\n        \"name\": \"첨부파일 추가\",\n        \"field\": \"imgs\",\n        \"label\": \"\",\n        \"format\": \"CImgUploaderArray\",\n        \"validate\": {\n          \"required\": false,\n          \"valid_required\": false\n        },\n        \"placeholder\": \"+첨부파일 추가\"\n      }],\n      \"list_product\": [],\n      \"booking_order_id\": undefined,\n      \"reservation_order_id\": undefined,\n      \"list_product_my_review\": []\n    };\n  },\n  created: function created() {\n    this.review_id = this.$route.query.review_id;\n    this.product_id = this.$route.query.product_id;\n    this.getReviewDetail();\n    this.getProductDetail();\n    this.initForm();\n  },\n  methods: {\n    initForm: function initForm() {\n      this.formData = this.setForm(this.formData);\n      var title = find(this.formData, 'field', 'title');\n      title.inputCustom = this.inputCustom;\n      var content = find(this.formData, 'field', 'content');\n      content.inputCustom = this.inputCustomTextarea;\n    },\n    getProductDetail: function () {\n      var _getProductDetail = _asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee() {\n        var _this = this;\n\n        var url;\n        return regeneratorRuntime.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                this.list_product = [];\n                url = \"user/\".concat(this.user.user_id, \"/mapping/product/\").concat(this.product_id, \"?fields=id,order_conversion_type,img,name,partner.name,price,like_count,shared_count,reviews_count,simple_desc,rate\");\n                _context.next = 4;\n                return this.$axios.get(url).then(function (res) {\n                  _this.list_product.push(res.data);\n                });\n\n              case 4:\n                if (!this.$route.query.author_id && this.user.user_id !== Number(this.$route.query.author_id)) this.getMyreview();\n\n              case 5:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee, this);\n      }));\n\n      function getProductDetail() {\n        return _getProductDetail.apply(this, arguments);\n      }\n\n      return getProductDetail;\n    }(),\n    getMyreview: function () {\n      var _getMyreview = _asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee2() {\n        var id, type, type_str, list;\n        return regeneratorRuntime.wrap(function _callee2$(_context2) {\n          while (1) {\n            switch (_context2.prev = _context2.next) {\n              case 0:\n                this.list_product_my_review = [];\n                this.booking_order_id = undefined;\n                id = this.list_product[0].id;\n                type = this.list_product[0].order_conversion_type;\n                type_str = type === 10 ? 'reservation' : type === 11 ? 'booking' : '';\n                list = [];\n                _context2.next = 8;\n                return this.$axios.get(\"user/\".concat(this.$store.getters.user.user_id, \"/\").concat(type_str, \"/order/review/\").concat(id)).then(function (res) {\n                  list = res.data.data;\n                });\n\n              case 8:\n                this.list_product_my_review = list.filter(function (item) {\n                  return item.order_status_kor === '이용완료';\n                });\n\n                if (this.list_product_my_review.length > 0) {\n                  if (type === 10) this.reservation_order_id = this.list_product_my_review[0].id;\n                  if (type === 11) this.booking_order_id = this.list_product_my_review[0].id;\n                } else {\n                  this.toast('구매후 1회 후기 작성 가능합니다.');\n                  this.$router.back();\n                }\n\n              case 10:\n              case \"end\":\n                return _context2.stop();\n            }\n          }\n        }, _callee2, this);\n      }));\n\n      function getMyreview() {\n        return _getMyreview.apply(this, arguments);\n      }\n\n      return getMyreview;\n    }(),\n    save: function save() {\n      var _this2 = this;\n\n      var result = this.getParamData(this.formData); // 주문상품의 후기일 경우\n\n      if (this.$route.query.order_product !== undefined) result.params.order_product_id = this.$route.query.order_product;\n\n      if (result.enable) {\n        if (this.review_id === undefined) {\n          console.log('200');\n          this.$axios.post(\"user/\".concat(this.user.user_id, \"/product/\").concat(this.product_id, \"/review\"), result.params).then(function (res) {\n            if (res.status === 200) {\n              _this2.toast('후기글이 작성되었습니다.');\n\n              if (_this2.$route.query && _this2.$route.query.partner_id !== undefined && _this2.$route.query.partner_id !== 'null') {\n                _this2.$router.replace(\"/product_detail?id=\".concat(_this2.$route.query.partner_id, \"&tab=1\"));\n              } else _this2.$router.replace(\"/product_detail?id=\".concat(_this2.product_id, \"&tab=1\"));\n            }\n          }).catch(function (err) {\n            if (!err.response.data.message) _this2.toast(err.response.data.detail);else _this2.toast(err.response.data.message);\n          });\n        } else {\n          this.$axios.patch(\"user/\".concat(this.user.user_id, \"/product/\").concat(this.product_id, \"/review/\").concat(this.review_id), result.params).then(function (res) {\n            if (res.status === 200) {\n              _this2.toast('후기글이 수정되었습니다.');\n\n              if (_this2.$route.query && _this2.$route.query.partner_id !== undefined && _this2.$route.query.partner_id !== 'null') {\n                _this2.$router.replace(\"/product_detail?id=\".concat(_this2.$route.query.partner_id, \"&tab=1\"));\n              } // if (this.$route.query&&this.$route.query.product_id) {\n              //   this.$router.replace(`/product_detail?id=${this.$route.query.product_id}`);\n              // }\n              else _this2.$router.replace(\"/product_detail?id=\".concat(_this2.product_id, \"&tab=1\"));\n            }\n          }).catch(function (err) {\n            if (!err.response.data.message) _this2.toast(err.response.data.detail);else _this2.toast(err.response.data.message);\n          });\n        }\n      }\n    },\n    getReviewDetail: function getReviewDetail() {\n      var _this3 = this;\n\n      if (this.review_id !== undefined) {\n        this.$axios.get(\"user/\".concat(this.user.user_id, \"/product/\").concat(this.product_id, \"/review/\").concat(this.review_id)).then(function (res) {\n          var data = res.data;\n\n          _this3.formData.forEach(function (item) {\n            item.value = data[item.field];\n          });\n        });\n      }\n    }\n  },\n  computed: {\n    buttonCustomCancel: function buttonCustomCancel() {\n      var styles = this.cloneItem(this.buttonCustom);\n      styles.backgroundColor = this.brandColor.sub.color;\n      return styles;\n    },\n    inputCustomTextarea: function inputCustomTextarea() {\n      var styles = this.cloneItem(this.inputCustom);\n      styles.height = '160px';\n      return styles;\n    }\n  },\n  watch: {}\n};",{"version":3,"sources":["BlockReviewReg.vue"],"names":[],"mappings":"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","sourcesContent":["<template>\n<div class=\"full-width flex-justify\" :style=\"[brandBgColor.main, pagePadding]\">\n  \n\n    <!-- 후기 작성 -->\n    <div class=\"full-width\">\n      <div style=\"margin-top:32px\">\n        <div class=\"size-20 margin-bottom-16 weight-500\">리뷰 작성</div>\n        <card-product-review\n            style=\"margin-bottom:36px\"\n            slot=\"card\"\n            v-for=\"item in list_product\"\n            :key=\"`card-${item.id}`\"\n            :card=\"item\"></card-product-review>\n            \n        <!--<card-product-review-->\n        <!--    style=\"margin-bottom:36px\"-->\n        <!--    slot=\"card\"-->\n        <!--    v-for=\"item in list_product\"-->\n        <!--    :key=\"`card-2-${item.id}`\"-->\n        <!--    :card=\"item\"></card-product-review>-->\n      </div>\n      <!-- 후기 폼 -->\n      <component :is=\"form.elType\" \n        v-for=\"(form,idx) in formData\"\n         :key=\"'review-form-'+idx\"\n         v-bind=\"form\"\n         :value.sync=\"form.value\"\n         :formType=\"formTypeCustomLabel\"\n         :containerCustomStyle=\"form.containerCustom\"\n         :labelCustomStyle=\"labelCustom\"\n         :inputCustomStyle=\"form.inputCustom\"\n         :buttonCustomStyle=\"buttonCustom\"></component>\n         \n\n    <div :style=\"buttonCustom\" style=\"margin: 48px 0 0;\" @click=\"save\">리뷰 작성</div>         \n    <div :style=\"buttonCustomCancel\" style=\"margin: 12px 0 20px;\" @click=\"clickBack\">취소</div>         \n\n      <!--<div class=\"flex-end\" style=\"margin:48px 0 12px\">-->\n      <!--  <btn :color=\"brandColor.white\"-->\n      <!--       :backgroundColor=\"brandBgColor.brand\"-->\n      <!--       @clicked=\"save\">리뷰 작성</btn>-->\n      <!--</div>-->\n      <!--<div>-->\n      <!--  <btn :backgroundColor=\"brandColor.sub\" :color=\"brandColor.white\"-->\n      <!--    @clicked=\"clickBack\">취소</btn>-->\n      <!--</div>-->\n    </div>\n  </div>\n</template>\n<script>\nimport CardProductReview from \"@/components/Components/Card/CardProductReview\"\nimport BlockMixin from \"@/components/Mixins/BlockMixin\"\nimport FormMixin from \"@/components/Mixins/FormMixin\"\nimport HeaderMixin from \"@/components/Mixins/HeaderMixin\"\nimport FormCustomMixin from \"@/components/Components/Mixin/FormCustomMixin\"\n\nexport default {\n  name: 'BlockReviewReg',\n  components: {\n    CardProductReview\n  },\n  mixins: [\n    BlockMixin,\n    FormMixin,\n    HeaderMixin,\n    FormCustomMixin\n  ],\n  props: {\n\n  },\n  data() {\n    return {\n      \"formData\": [\n        {\n          \"name\": \"평점\",\n          \"field\": \"rate\",\n          \"label\": \"평점\",\n          \"value\": 5,\n          \"format\": \"CRating\",\n          \"validate\": {\n            \"required\": false,\n            \"valid_required\": false\n          }\n        },\n        {\n          \"name\": \"제목\",\n          \"field\": \"title\",\n          \"label\": \"제목\",\n          \"value\": \"\",\n          \"format\": \"CInput_text\",\n          \"validate\": {\n            \"num\": true,\n            \"alpha_g\": true,\n            \"alpha_s\": true,\n            \"special\": true,\n            \"required\": true,\n            \"max_length\": 30,\n            \"min_length\": 1,\n            \"valid_required\": true\n          },\n          \"placeholder\": \"제목을 입력하세요\"\n        },\n        {\n          \"name\": \"내용\",\n          \"field\": \"content\",\n          \"label\": \"내용\",\n          \"value\": \"\",\n          \"format\": \"CInput_textarea\",\n          \"validate\": {\n            \"num\": true,\n            \"alpha_g\": true,\n            \"alpha_s\": true,\n            \"special\": true,\n            \"required\": true,\n            \"max_length\": 500,\n            \"min_length\": 1,\n            \"valid_required\": true\n          },\n          \"placeholder\": \"내용을 입력하세요\"\n        },\n        {\n          \"name\": \"비밀글\",\n          \"field\": \"is_secret\",\n          \"label\": \"비밀글로 작성합니다.\",\n          \"value\": false,\n          \"format\": \"CInput_checkbox\",\n          \"validate\": {\n            \"num\": true,\n            \"alpha_g\": true,\n            \"alpha_s\": true,\n            \"special\": true,\n            \"required\": false,\n            \"valid_required\": false\n          },\n          \"placeholder\": \"\"\n        },\n        {\n          \"name\": \"첨부파일 추가\",\n          \"field\": \"imgs\",\n          \"label\": \"\",\n          \"format\": \"CImgUploaderArray\",\n          \"validate\": {\n            \"required\": false,\n            \"valid_required\": false\n          },\n          \"placeholder\": \"+첨부파일 추가\"\n        }\n      ],\n      \"list_product\": [],\n      \"booking_order_id\": undefined,\n      \"reservation_order_id\": undefined,\n      \"list_product_my_review\": []\n    }\n  },\n  created() {\n      this.review_id = this.$route.query.review_id;\n      this.product_id = this.$route.query.product_id;\n      this.getReviewDetail();\n      this.getProductDetail();\n      this.initForm();\n    },\n  \n  methods: {\n    initForm() {\n      this.formData = this.setForm(this.formData);\n      \n      let title = find(this.formData, 'field', 'title');\n      title.inputCustom = this.inputCustom;\n      \n      let content = find(this.formData, 'field', 'content');\n      content.inputCustom = this.inputCustomTextarea;\n    },\n    async getProductDetail() {\n      this.list_product =[];\n        let url = `user/${this.user.user_id}/mapping/product/${this.product_id}?fields=id,order_conversion_type,img,name,partner.name,price,like_count,shared_count,reviews_count,simple_desc,rate`;\n        await this.$axios.get(url).then(res => {\n          this.list_product.push(res.data);\n        })\n        if(!this.$route.query.author_id && this.user.user_id !== Number(this.$route.query.author_id)) this.getMyreview();\n      },\n    async getMyreview() {\n      this.list_product_my_review = [];\n      this.booking_order_id = undefined;\n\n      let id = this.list_product[0].id;\n      let type = this.list_product[0].order_conversion_type;\n      let type_str = type===10 ? 'reservation' : type===11 ? 'booking' : '';\n      let list = [];\n      await this.$axios.get(`user/${this.$store.getters.user.user_id}/${type_str}/order/review/${id}`)\n      .then(res => {\n        list = res.data.data;\n      })\n      this.list_product_my_review = list.filter(item => { return item.order_status_kor==='이용완료'});\n      if(this.list_product_my_review.length>0) {\n        if(type===10) this.reservation_order_id = this.list_product_my_review[0].id;\n        if(type===11) this.booking_order_id = this.list_product_my_review[0].id;\n      }\n      else {\n        this.toast('구매후 1회 후기 작성 가능합니다.')\n        this.$router.back();\n      }\n\n    },\n    save() {\n        let result = this.getParamData(this.formData);\n        \n        \n        // 주문상품의 후기일 경우\n        if (this.$route.query.order_product!==undefined) result.params.order_product_id = this.$route.query.order_product;\n        \n        if(result.enable) {\n\n          if(this.review_id===undefined) {\n            console.log('200')\n            this.$axios.post(`user/${this.user.user_id}/product/${this.product_id}/review`, result.params)\n              .then(res => {\n                \n                if(res.status===200) {\n                  \n                  this.toast('후기글이 작성되었습니다.');\n                  if (this.$route.query&&this.$route.query.partner_id!==undefined&&this.$route.query.partner_id!=='null') {\n                    this.$router.replace(`/product_detail?id=${this.$route.query.partner_id}&tab=1`);\n                  }\n                  else this.$router.replace(`/product_detail?id=${this.product_id}&tab=1`);\n                }\n              }).catch(err=> {\n              if(!err.response.data.message)\n                this.toast(err.response.data.detail);\n              else\n                this.toast(err.response.data.message);\n            })\n          }\n          else {\n            this.$axios.patch(`user/${this.user.user_id}/product/${this.product_id}/review/${this.review_id}`, result.params)\n              .then(res => {\n                if(res.status===200) {\n                  this.toast('후기글이 수정되었습니다.');\n                  if (this.$route.query&&this.$route.query.partner_id!==undefined&&this.$route.query.partner_id!=='null') {\n                    this.$router.replace(`/product_detail?id=${this.$route.query.partner_id}&tab=1`);\n                  }\n                  // if (this.$route.query&&this.$route.query.product_id) {\n                  //   this.$router.replace(`/product_detail?id=${this.$route.query.product_id}`);\n                  // }\n                  else this.$router.replace(`/product_detail?id=${this.product_id}&tab=1`);\n                }\n              }).catch(err=> {\n              if(!err.response.data.message)\n                this.toast(err.response.data.detail);\n              else\n                this.toast(err.response.data.message);\n            })\n          }\n        }\n      },\n    getReviewDetail() {\n        if(this.review_id!==undefined) {\n          this.$axios.get(`user/${this.user.user_id}/product/${this.product_id}/review/${this.review_id}`).then(res=>{\n            let data = res.data;\n            this.formData.forEach(item=>{\n              item.value = data[item.field];\n            })\n          })\n        }\n      }\n  },\n  computed: {\n    buttonCustomCancel() {\n      let styles = this.cloneItem(this.buttonCustom);\n      styles.backgroundColor = this.brandColor.sub.color;\n      return styles;\n    },\n    inputCustomTextarea() {\n      let styles = this.cloneItem(this.inputCustom);\n      styles.height = '160px';\n      return styles;\n    }\n  },\n  watch: {\n    \n  }\n}\n</script>\n\n\n"],"sourceRoot":"src/components/Components/Block"}]}